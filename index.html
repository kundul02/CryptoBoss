<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Криптобосс - Тапалка</title>
    <style>
        /* Общие стили для всего документа */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Стили для тела страницы */
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Контейнер для центрирования и ограничения ширины содержимого */
        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 10px; /* Уменьшен padding для экономии места */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Распределяем пространство между элементами */
        }

        /* Стили для заголовка игры */
        .header {
            text-align: center;
            padding: 15px 0; /* Уменьшен padding */
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            margin-bottom: 15px; /* Уменьшен margin */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Стили для названия игры */
        .title {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700; /* Цвет золота */
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            margin-bottom: 10px;
        }

        /* Стили для блока статистики (используем Grid для выравнивания) */
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* Две колонки равной ширины */
            gap: 5px; /* Уменьшены отступы между элементами */
            justify-items: center; /* Центрирование элементов по горизонтали */
            align-items: stretch; /* Растягивание элементов по высоте */
        }

        /* Стили для отдельного элемента статистики */
        .stat {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 100%; /* Занимает всю доступную ширину в своей ячейке сетки */
            display: flex; /* Используем flexbox для центрирования содержимого внутри stat */
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Стили для значения статистики */
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #ffd700;
        }

        /* Стили для метки статистики */
        .stat-label {
            font-size: 11px; /* Немного уменьшен шрифт */
            color: #cccccc;
        }

        /* Стили для игровой области */
        .game-area {
            flex: 1; /* Позволяет области расти и сжиматься */
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            padding: 20px 0; /* Уменьшен padding */
            min-height: 200px; /* Минимальная высота для видимости персонажа */
            max-height: 40vh; /* Ограничиваем максимальную высоту процентом от высоты вьюпорта */
        }

        /* Стили для игрового персонажа */
        .character {
            width: 60vw; /* Адаптивная ширина */
            height: 60vw; /* Сохраняем пропорции */
            max-width: 250px; /* Максимальный размер */
            max-height: 250px; /* Максимальный размер */
            cursor: pointer;
            transition: transform 0.1s ease;
            filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.5));
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%; /* Делаем круглым */
            overflow: hidden; /* Обрезает содержимое по границам круга */
        }

        /* Эффект при наведении на персонажа */
        .character:hover {
            transform: scale(1.05);
        }

        /* Эффект при активном нажатии на персонажа */
        .character:active {
            transform: scale(0.95);
            outline: none !important; /* Убираем outline при активном состоянии */
        }
        /* Убираем outline при фокусе для персонажа */
        .character:focus {
            outline: none !important;
        }

        /* Стили для изображений внутри персонажа */
        .character img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Заполняет круг, обрезая лишнее */
            border-radius: 50%; /* На всякий случай, если overflow hidden не сработает */
        }

        /* Стили для эффекта тапа (появляющиеся числа) */
        .tap-effect {
            position: absolute;
            pointer-events: none;
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            animation: floatUp 1s ease-out forwards;
        }

        /* Анимация для эффекта тапа */
        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px) scale(1.2);
            }
        }

        /* Стили для эффекта критического удара */
        .crit-effect {
            position: absolute;
            pointer-events: none;
            font-size: 32px;
            font-weight: bold;
            color: #ff6b6b;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.8);
            animation: critFloat 1.5s ease-out forwards;
        }

        /* Анимация для эффекта критического удара */
        @keyframes critFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-80px) scale(1.5);
            }
        }

        /* Стили для отображения комбо */
        .combo-display {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            color: #ffd700;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        /* Класс для показа комбо */
        .combo-display.show {
            opacity: 1;
        }

        /* Стили для блока улучшений */
        .upgrades {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px; /* Уменьшен padding */
            margin-top: 15px; /* Уменьшен margin */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Стили для заголовка улучшений */
        .upgrade-title {
            font-size: 18px;
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
        }

        /* Стили для отдельного элемента улучшения */
        .upgrade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px; /* Уменьшен padding */
            margin: 8px 0; /* Уменьшен margin */
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Стили для информации об улучшении */
        .upgrade-info {
            flex: 1;
        }

        /* Стили для названия улучшения */
        .upgrade-name {
            font-weight: bold;
            color: #ffffff;
        }

        /* Стили для описания улучшения */
        .upgrade-desc {
            font-size: 11px; /* Немного уменьшен шрифт */
            color: #cccccc;
        }

        /* Стили для кнопки улучшения */
        .upgrade-button {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* Эффект при наведении на кнопку улучшения */
        .upgrade-button:hover {
            background: linear-gradient(45deg, #ffed4e, #ffd700);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        /* Стили для отключенной кнопки улучшения */
        .upgrade-button:disabled {
            background: #666;
            color: #999;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Стили для полосы энергии */
        .energy-bar {
            width: 100%;
            height: 18px; /* Уменьшена высота */
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0; /* Уменьшен margin */
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative; /* Добавлено для позиционирования текста внутри */
        }

        /* Стили для заполнения полосы энергии (красный -> желтый -> зеленый) */
        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF0000, #FFFF00, #4CAF50); /* Красный -> Желтый -> Зеленый */
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        /* Стили для текста энергии внутри полосы */
        .energy-text-inside {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ffd700; /* Цвет золота, как у заголовка */
            font-size: 13px; /* Немного уменьшен шрифт */
            font-weight: bold;
            /* Добавлена черная обводка */
            text-shadow: -1px -1px 0 #000,  
                          1px -1px 0 #000,
                         -1px 1px 0 #000,
                          1px 1px 0 #000;
            width: 100%; /* Чтобы текст оставался по центру всей полосы */
            text-align: center;
        }

        /* Стили для всплывающего окна достижений */
        .achievement {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000;
            padding: 15px 20px;
            border-radius: 10px;
            font-weight: bold;
            transform: translateX(300px); /* Скрыто по умолчанию */
            transition: transform 0.5s ease;
            z-index: 1000;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
        }

        /* Класс для показа всплывающего окна достижений */
        .achievement.show {
            transform: translateX(0);
        }

        /* Стили для множителя (не используется в текущем коде, но оставлен) */
        .multiplier {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 32px;
            color: #ff6b6b;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.8);
            opacity: 0;
            animation: pulse 0.5s ease-out;
        }

        /* Анимация для множителя */
        @keyframes pulse {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }

        /* Стили для баннера события */
        .event-banner {
            background: linear-gradient(45deg, #ff6b6b, #ffd700, #ff6b6b);
            background-size: 200% 200%;
            animation: gradientShift 2s ease infinite;
            color: #000;
            padding: 15px;
            text-align: center;
            border-radius: 10px;
            margin: 10px 0;
            font-weight: bold;
            border: 2px solid #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        /* Анимация для градиента баннера события */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Стили для текста события */
        .event-text {
            font-size: 16px;
            margin-bottom: 5px;
        }

        /* Стили для таймера события */
        .event-timer {
            font-size: 14px;
            opacity: 0.8;
        }

        /* Стили для кнопок сохранения/загрузки */
        .save-load {
            margin-top: 20px;
            text-align: center;
        }

        /* Стили для кнопок сохранения/загрузки */
        .save-load button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        /* Эффект при наведении на кнопки сохранения/загрузки */
        .save-load button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        /* Убираем outline при фокусе для кнопок */
        button:focus {
            outline: none !important;
        }

        /* Медиа-запросы для очень маленьких экранов (по высоте) */
        @media (max-height: 600px) {
            .header {
                padding: 10px 0;
                margin-bottom: 10px;
            }
            .title {
                font-size: 20px;
            }
            .stat-value {
                font-size: 16px;
            }
            .stat-label {
                font-size: 10px;
            }
            .game-area {
                padding: 10px 0;
                max-height: 35vh; /* Еще больше уменьшаем высоту игровой области */
            }
            .character {
                width: 50vw; /* Уменьшаем размер персонажа */
                height: 50vw;
            }
            .upgrades {
                padding: 10px;
                margin-top: 10px;
            }
            .upgrade-item {
                padding: 6px;
                margin: 6px 0;
            }
            .upgrade-name {
                font-size: 14px;
            }
            .upgrade-desc {
                font-size: 10px;
            }
            .upgrade-button {
                padding: 6px 10px;
                font-size: 12px;
            }
            .energy-bar {
                height: 16px;
                margin: 10px 0;
            }
            .energy-text-inside {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">💰 КРИПТОБОСС 💰</div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="coins">0</div>
                    <div class="stat-label">JRK Коины</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="level">1</div>
                    <div class="stat-label">Уровень</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="power">1</div>
                    <div class="stat-label">Сила тапа</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="cps">0</div>
                    <div class="stat-label">JRK/сек</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="prestigePoints">0</div>
                    <div class="stat-label">💎 Престиж</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="maxCombo">0</div>
                    <div class="stat-label">🔥 Макс комбо</div>
                </div>
            </div>
        </div>

        <div class="energy-bar">
            <div class="energy-fill" id="energyFill"></div>
            <span class="energy-text-inside" id="energyTextInside">Энергия: 100/100</span>
        </div>

        <div id="eventBanner" class="event-banner" style="display: none;">
            <div class="event-text">🎉 ЗОЛОТАЯ ЛИХОРАДКА АКТИВНА! x2 КОИНЫ</div>
            <div class="event-timer">Осталось: <span id="eventTimer">0</span>с</div>
        </div>

        <div class="game-area">
            <div class="character" id="character">
                <img src="https://imgur.com/wQFlKJz.png" alt="Криптобосс" onerror="this.onerror=null;this.src='https://placehold.co/250x250/1e4a72/ffffff?text=CryptoBoss';">
            </div>
        </div>

        <div class="upgrades">
            <div class="upgrade-title">🚀 Улучшения</div>
            
            <div class="upgrade-item">
                <div class="upgrade-info">
                    <div class="upgrade-name">Сильный тап</div>
                    <div class="upgrade-desc">+1 к силе тапа</div>
                </div>
                <button class="upgrade-button" onclick="buyUpgrade('power')">
                    💪 <span id="powerCost">10</span>
                </button>
            </div>

            <div class="upgrade-item">
                <div class="upgrade-info">
                    <div class="upgrade-name">Автокликер</div>
                    <div class="upgrade-desc">+1 монета в секунду</div>
                </div>
                <button class="upgrade-button" onclick="buyUpgrade('auto')">
                    🤖 <span id="autoCost">50</span>
                </button>
            </div>

            <div class="upgrade-item">
                <div class="upgrade-info">
                    <div class="upgrade-name">Больше энергии</div>
                    <div class="upgrade-desc">+20 к максимальной энергии</div>
                </div>
                <button class="upgrade-button" onclick="buyUpgrade('energy')">
                    ⚡ <span id="energyCost">100</span>
                </button>
            </div>

            <div class="upgrade-item">
                <div class="upgrade-info">
                    <div class="upgrade-name">Критический удар</div>
                    <div class="upgrade-desc">+5% шанс крита (x2 коины)</div>
                </div>
                <button class="upgrade-button" onclick="buyUpgrade('crit')">
                    ⚡ <span id="critCost">200</span>
                </button>
            </div>

            <div class="upgrade-item">
                <div class="upgrade-info">
                    <div class="upgrade-name">Крипто ферма</div>
                    <div class="upgrade-desc">+5 монет в секунду</div>
                </div>
                <button class="upgrade-button" onclick="buyUpgrade('farm')">
                    🏭 <span id="farmCost">500</span>
                </button>
            </div>

            <div class="upgrade-item">
                <div class="upgrade-info">
                    <div class="upgrade-name">🎯 Запуск события</div>
                    <div class="upgrade-desc">30 сек x2 коинов</div>
                </div>
                <button class="upgrade-button" onclick="startEvent()" id="eventButton">
                    🚀 1000
                </button>
            </div>

            <div class="upgrade-item">
                <div class="upgrade-info">
                    <div class="upgrade-name">💎 ПРЕСТИЖ</div>
                    <div class="upgrade-desc">Сброс за постоянные бонусы</div>
                </div>
                <button class="upgrade-button" onclick="prestige()" id="prestigeButton">
                    ♻️ Перерождение
                </button>
            </div>
        </div>

        <div class="save-load">
            <button onclick="saveGame()">💾 Сохранить</button>
            <button onclick="loadGame()">📁 Загрузить</button>
            <button onclick="resetGame()">🔄 Сброс</button>
        </div>
    </div>

    <div class="achievement" id="achievement"></div>

    <script>
        // Игровое состояние
        let gameState = {
            coins: 0,
            level: 1,
            tapPower: 1,
            autoClickers: 0,
            farms: 0,
            maxEnergy: 100,
            energy: 100,
            totalTaps: 0,
            cps: 0,
            multiplier: 1,
            lastMultiplier: Date.now(),
            prestigePoints: 0,
            totalEarned: 0,
            critChance: 5,
            critMultiplier: 2,
            comboCount: 0,
            maxCombo: 0,
            eventActive: false,
            eventTimeLeft: 0,
            eventMultiplier: 1
        };

        // Стоимость улучшений
        let upgradeCosts = {
            power: 10,
            auto: 50,
            energy: 100,
            farm: 500,
            crit: 200,
            event: 1000
        };

        // Список достижений
        const achievements = [
            { id: 'first_tap', name: 'Первый тап!', desc: 'Сделайте первый тап', coins: 1, unlocked: false },
            { id: 'tap_master', name: 'Мастер тапа', desc: 'Сделайте 100 тапов', taps: 100, unlocked: false },
            { id: 'rich', name: 'Богач', desc: 'Накопите 1000 монет', coins: 1000, unlocked: false },
            { id: 'auto_lord', name: 'Лорд автоматизации', desc: 'Купите 10 автокликеров', auto: 10, unlocked: false },
            { id: 'crypto_king', name: 'Король крипты', desc: 'Достигните 10 уровня', level: 10, unlocked: false },
            { id: 'combo_master', name: 'Мастер комбо', desc: 'Достигните комбо x20', combo: 20, unlocked: false },
            { id: 'prestige_first', name: 'Первое перерождение', desc: 'Используйте престиж впервые', prestige: 1, unlocked: false }
        ];

        /**
         * Обновляет отображение всех игровых показателей на экране.
         */
        function updateDisplay() {
            document.getElementById('coins').textContent = formatNumber(Math.floor(gameState.coins));
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('power').textContent = gameState.tapPower;
            document.getElementById('cps').textContent = gameState.cps.toFixed(1);
            document.getElementById('prestigePoints').textContent = gameState.prestigePoints;
            document.getElementById('maxCombo').textContent = gameState.maxCombo;
            
            // Обновляем ширину полосы энергии
            document.getElementById('energyFill').style.width = (gameState.energy / gameState.maxEnergy) * 100 + '%';
            // Обновляем текст энергии внутри полосы
            document.getElementById('energyTextInside').textContent = `Энергия: ${Math.floor(gameState.energy)}/${gameState.maxEnergy}`;

            // Обновление стоимости улучшений
            document.getElementById('powerCost').textContent = formatNumber(upgradeCosts.power);
            document.getElementById('autoCost').textContent = formatNumber(upgradeCosts.auto);
            document.getElementById('energyCost').textContent = formatNumber(upgradeCosts.energy);
            document.getElementById('farmCost').textContent = formatNumber(upgradeCosts.farm);
            document.getElementById('critCost').textContent = formatNumber(upgradeCosts.crit);

            // Обновление кнопки события
            const eventBtn = document.getElementById('eventButton');
            if (gameState.eventActive) {
                eventBtn.textContent = '🚀 Активно';
                eventBtn.disabled = true;
            } else {
                eventBtn.textContent = '🚀 1000';
                eventBtn.disabled = gameState.coins < 1000;
            }

            // Обновление кнопки престижа
            const prestigeBtn = document.getElementById('prestigeButton');
            const prestigeGain = Math.floor(gameState.totalEarned / 100000);
            prestigeBtn.disabled = prestigeGain <= 0;
            prestigeBtn.textContent = `♻️ +${prestigeGain} 💎`;

            // Обновление состояния кнопок улучшений (доступность)
            updateUpgradeButtons();
        }

        /**
         * Обновляет состояние (доступность) кнопок улучшений в зависимости от количества монет.
         */
        function updateUpgradeButtons() {
            const buttons = document.querySelectorAll('.upgrade-button');
            const costs = [
                upgradeCosts.power,
                upgradeCosts.auto,
                upgradeCosts.energy,
                upgradeCosts.crit,
                upgradeCosts.farm
            ];

            buttons.forEach((btn, index) => {
                if (index < costs.length) {
                    btn.disabled = gameState.coins < costs[index];
                }
            });
        }

        /**
         * Форматирует число для отображения (например, 1000 -> 1K, 1000000 -> 1M).
         * @param {number} num - Число для форматирования.
         * @returns {string} Отформатированное число.
         */
        function formatNumber(num) {
            if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return num.toString();
        }

        /**
         * Обрабатывает событие тапа по персонажу.
         * @param {Event} event - Объект события клика.
         */
        function tap(event) {
            // Энергия расходуется быстрее при частых кликах: 1 + (комбо * 0.2)
            const energyCost = 1 + (gameState.comboCount * 0.2); 
            if (gameState.energy <= 0) return; // Если энергия закончилась, тап не происходит

            gameState.energy -= energyCost; // Уменьшаем энергию за тап
            
            // Система комбо
            const now = Date.now();
            if (now - gameState.lastMultiplier < 800) { // Если тап сделан быстро (в течение 800 мс)
                gameState.comboCount++;
                gameState.multiplier = Math.min(1 + (gameState.comboCount * 0.1), 5); // Множитель до 5x
            } else { // Если тап сделан медленно, сбрасываем комбо
                gameState.comboCount = 0;
                gameState.multiplier = 1;
            }
            gameState.lastMultiplier = now;

            // Обновляем максимальное комбо
            gameState.maxCombo = Math.max(gameState.maxCombo, gameState.comboCount);

            // Проверка на критический удар
            const isCrit = Math.random() * 100 < gameState.critChance;
            let earnedCoins = gameState.tapPower * gameState.multiplier;
            
            if (isCrit) {
                earnedCoins *= gameState.critMultiplier;
                // showCritEffect(event); // Убрано по запросу пользователя
            }

            // Event multiplier
            if (gameState.eventActive) {
                earnedCoins *= gameState.eventMultiplier;
            }

            // Prestige bonus
            const prestigeBonus = 1 + (gameState.prestigePoints * 0.1);
            earnedCoins *= prestigeBonus;

            gameState.coins += earnedCoins; // Добавляем монеты
            gameState.totalEarned += earnedCoins; // Учитываем общее количество заработанных монет
            gameState.totalTaps++; // Увеличиваем счетчик тапов

            // showTapEffect(event, displayText, isCrit); // Убрано по запросу пользователя

            // Показываем комбо, если оно достаточно большое
            if (gameState.comboCount > 5) {
                showCombo();
            }

            // Проверка на повышение уровня
            const newLevel = Math.floor(gameState.totalTaps / 50) + 1;
            if (newLevel > gameState.level) {
                gameState.level = newLevel;
                showAchievement('Новый уровень!', `Достигнут ${gameState.level} уровень!`);
            }

            checkAchievements(); // Проверяем достижения
            updateDisplay(); // Обновляем отображение
        }

        /**
         * Показывает всплывающий эффект с количеством заработанных монет.
         * Эта функция была убрана по запросу пользователя.
         * @param {Event} event - Объект события клика.
         * @param {string} text - Текст для отображения (например, "+10").
         * @param {boolean} isCrit - Флаг, указывающий, является ли это критическим ударом.
         */
        /*
        function showTapEffect(event, text, isCrit = false) {
            const effect = document.createElement('div');
            effect.className = isCrit ? 'crit-effect' : 'tap-effect';
            effect.textContent = text;
            
            const rect = event.target.closest('.character').getBoundingClientRect();
            const x = event.clientX - rect.left + (Math.random() - 0.5) * 50; // Случайное смещение по X
            const y = event.clientY - rect.top + (Math.random() - 0.5) * 50; // Случайное смещение по Y
            
            effect.style.left = x + 'px';
            effect.style.top = y + 'px';
            
            event.target.closest('.character').appendChild(effect);
            
            setTimeout(() => effect.remove(), isCrit ? 1500 : 1000); // Удаляем эффект через некоторое время
        }
        */

        /**
         * Показывает визуальный эффект критического удара на персонаже.
         * Эта функция была убрана по запросу пользователя.
         */
        /*
        function showCritEffect() {
            const character = document.querySelector('.character');
            character.style.filter = 'drop-shadow(0 10px 30px rgba(255, 107, 107, 0.8))'; // Красное свечение
            setTimeout(() => {
                character.style.filter = 'drop-shadow(0 10px 30px rgba(0, 0, 0, 0.5))'; // Возвращаем обычное свечение
            }, 200);
        }
        */

        /**
         * Показывает всплывающее сообщение о комбо.
         */
        function showCombo() {
            const comboDisplay = document.querySelector('.combo-display') || createComboDisplay();
            comboDisplay.textContent = `🔥 КОМБО x${gameState.comboCount}`;
            comboDisplay.classList.add('show');
            
            setTimeout(() => {
                comboDisplay.classList.remove('show');
            }, 1000);
        }

        /**
         * Создает элемент для отображения комбо, если его еще нет.
         * @returns {HTMLElement} Элемент комбо.
         */
        function createComboDisplay() {
            const combo = document.createElement('div');
            combo.className = 'combo-display';
            document.querySelector('.game-area').appendChild(combo);
            return combo;
        }

        /**
         * Запускает событие "Золотая лихорадка" (x2 коины на 30 секунд).
         */
        function startEvent() {
            if (gameState.coins < 1000 || gameState.eventActive) return; // Проверка стоимости и активности события
            
            gameState.coins -= 1000;
            gameState.eventActive = true;
            gameState.eventTimeLeft = 30;
            gameState.eventMultiplier = 2;
            
            document.getElementById('eventBanner').style.display = 'block'; // Показываем баннер события
            showAchievement('🎉 Событие запущено!', 'Золотая лихорадка активна!');
            updateDisplay();
        }

        /**
         * Запускает случайное событие (x3 коины на 15 секунд).
         */
        function startRandomEvent() {
            gameState.eventActive = true;
            gameState.eventTimeLeft = 15;
            gameState.eventMultiplier = 3;
            
            document.getElementById('eventBanner').style.display = 'block';
            document.querySelector('.event-text').textContent = '🌟 СЛУЧАЙНОЕ СОБЫТИЕ! x3 КОИНЫ';
            showAchievement('🌟 Удача!', 'Случайное событие началось!');
        }

        /**
         * Выполняет операцию "Престиж", сбрасывая прогресс, но сохраняя очки престижа.
         */
        function prestige() {
            const prestigeGain = Math.floor(gameState.totalEarned / 100000); // Расчет очков престижа
            if (prestigeGain <= 0) return;

            // Сохраняем очки престижа и максимальное комбо перед сбросом
            const oldPrestige = gameState.prestigePoints;
            const oldMaxCombo = gameState.maxCombo;
            
            // Сброс игрового состояния
            gameState = {
                coins: 0,
                level: 1,
                tapPower: 1,
                autoClickers: 0,
                farms: 0,
                maxEnergy: 100,
                energy: 100,
                totalTaps: 0,
                cps: 0,
                multiplier: 1,
                lastMultiplier: Date.now(),
                prestigePoints: oldPrestige + prestigeGain, // Добавляем новые очки престижа
                totalEarned: 0,
                critChance: 5,
                critMultiplier: 2,
                comboCount: 0,
                maxCombo: oldMaxCombo, // Сохраняем максимальное комбо
                eventActive: false,
                eventTimeLeft: 0,
                eventMultiplier: 1
            };

            // Сброс стоимости улучшений до начальных значений
            upgradeCosts = {
                power: 10,
                auto: 50,
                energy: 100,
                farm: 500,
                crit: 200,
                event: 1000
            };

            showAchievement('💎 Престиж!', `Получено ${prestigeGain} очков престижа!`);
            updateDisplay();
        }

        /**
         * Покупает указанное улучшение.
         * @param {string} type - Тип улучшения (например, 'power', 'auto').
         */
        function buyUpgrade(type) {
            const cost = upgradeCosts[type];
            if (gameState.coins < cost) return; // Проверка, достаточно ли монет

            gameState.coins -= cost; // Вычитаем стоимость

            // Применяем эффект улучшения и увеличиваем стоимость следующего
            switch(type) {
                case 'power':
                    gameState.tapPower++;
                    upgradeCosts.power = Math.floor(upgradeCosts.power * 1.5);
                    break;
                case 'auto':
                    gameState.autoClickers++;
                    gameState.cps += 1;
                    upgradeCosts.auto = Math.floor(upgradeCosts.auto * 1.8);
                    break;
                case 'energy':
                    gameState.maxEnergy += 20;
                    gameState.energy = gameState.maxEnergy; // Восстанавливаем энергию до нового максимума
                    upgradeCosts.energy = Math.floor(upgradeCosts.energy * 2);
                    break;
                case 'crit':
                    gameState.critChance += 5;
                    upgradeCosts.crit = Math.floor(upgradeCosts.crit * 2.5);
                    break;
                case 'farm':
                    gameState.farms++;
                    gameState.cps += 5;
                    upgradeCosts.farm = Math.floor(upgradeCosts.farm * 2.2);
                    break;
            }

            updateDisplay(); // Обновляем отображение
        }

        /**
         * Проверяет, были ли разблокированы какие-либо достижения.
         */
        function checkAchievements() {
            achievements.forEach(achievement => {
                if (achievement.unlocked) return; // Пропускаем уже разблокированные

                let unlocked = false;
                if (achievement.coins && gameState.coins >= achievement.coins) unlocked = true;
                if (achievement.taps && gameState.totalTaps >= achievement.taps) unlocked = true;
                if (achievement.level && gameState.level >= achievement.level) unlocked = true;
                if (achievement.auto && gameState.autoClickers >= achievement.auto) unlocked = true;
                if (achievement.combo && gameState.maxCombo >= achievement.combo) unlocked = true;
                if (achievement.prestige && gameState.prestigePoints >= achievement.prestige) unlocked = true;

                if (unlocked) {
                    achievement.unlocked = true;
                    showAchievement(achievement.name, achievement.desc); // Показываем уведомление о достижении
                }
            });
        }

        /**
         * Показывает всплывающее уведомление о достижении.
         * @param {string} title - Заголовок достижения.
         * @param {string} desc - Описание достижения.
         */
        function showAchievement(title, desc) {
            const achievementEl = document.getElementById('achievement');
            achievementEl.innerHTML = `<strong>${title}</strong><br>${desc}`;
            achievementEl.classList.add('show'); // Показываем уведомление
            
            setTimeout(() => {
                achievementEl.classList.remove('show'); // Скрываем уведомление через 3 секунды
            }, 3000);
        }

        /**
         * Сохраняет текущее игровое состояние в локальное хранилище.
         */
        function saveGame() {
            localStorage.setItem('cryptoBossGame', JSON.stringify(gameState));
            showAchievement('💾 Сохранено!', 'Игра успешно сохранена');
        }

        /**
         * Загружает игровое состояние из локального хранилища.
         */
        function loadGame() {
            const saved = localStorage.getItem('cryptoBossGame');
            if (saved) {
                // Объединяем загруженное состояние с текущим, чтобы учесть новые свойства
                const loadedState = JSON.parse(saved);
                gameState = { ...gameState, ...loadedState }; 
                updateDisplay();
                showAchievement('📁 Загружено!', 'Игра успешно загружена');
            }
        }

        /**
         * Сбрасывает игру до начального состояния.
         */
        function resetGame() {
            // Используем пользовательский модальный диалог вместо confirm()
            const confirmReset = document.createElement('div');
            confirmReset.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.9);
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
                z-index: 9999;
                text-align: center;
                color: white;
            `;
            confirmReset.innerHTML = `
                <p style="margin-bottom: 20px;">Вы уверены, что хотите сбросить всю игру?</p>
                <button id="confirmResetBtn" style="background: #ff6b6b; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin-right: 10px; cursor: pointer;">Да</button>
                <button id="cancelResetBtn" style="background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Нет</button>
            `;
            document.body.appendChild(confirmReset);

            document.getElementById('confirmResetBtn').onclick = () => {
                localStorage.removeItem('cryptoBossGame');
                location.reload();
                confirmReset.remove();
            };

            document.getElementById('cancelResetBtn').onclick = () => {
                confirmReset.remove();
            };
        }

        // Основной игровой цикл
        function gameLoop() {
            // Автоматический доход от автокликеров и ферм
            if (gameState.cps > 0) {
                let autoIncome = gameState.cps / 10; // Обновляем 10 раз в секунду
                
                if (gameState.eventActive) {
                    autoIncome *= gameState.eventMultiplier;
                }
                
                const prestigeBonus = 1 + (gameState.prestigePoints * 0.1);
                autoIncome *= prestigeBonus;
                
                gameState.coins += autoIncome;
                gameState.totalEarned += autoIncome;
            }

            // Регенерация энергии
            if (gameState.energy < gameState.maxEnergy) {
                gameState.energy += 0.5; // 5 энергии в секунду
                if (gameState.energy > gameState.maxEnergy) {
                    gameState.energy = gameState.maxEnergy;
                }
            }

            // Таймер события
            if (gameState.eventActive) {
                gameState.eventTimeLeft -= 0.1; // Уменьшаем время каждую 0.1 секунду
                document.getElementById('eventTimer').textContent = Math.ceil(gameState.eventTimeLeft);
                
                if (gameState.eventTimeLeft <= 0) {
                    gameState.eventActive = false;
                    gameState.eventMultiplier = 1;
                    document.getElementById('eventBanner').style.display = 'none'; // Скрываем баннер
                }
            }

            // Случайные события (с небольшой вероятностью)
            if (!gameState.eventActive && Math.random() < 0.0001) { // 0.01% шанс за тик
                startRandomEvent();
            }

            updateDisplay(); // Обновляем отображение
        }

        // Добавляем слушатель событий для клика по персонажу
        document.getElementById('character').addEventListener('click', tap);

        // Загружаем игру при запуске страницы
        loadGame();

        // Запускаем игровой цикл с интервалом 100 мс (10 раз в секунду)
        setInterval(gameLoop, 100); 
    </script>
</body>
</html>
